{% load static %}


<head>
    <link rel="stylesheet" href="{% static 'css/reserve_styles.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>座席条件</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>


<body>
    <div class="container">
        <div class="condition_message">
            ただいま満席です
        </div>
            <div class="seat-selection">
                <h4>ご希望の座席の条件を入力してください</h4>
                <form id="seatForm" method="post">
                    {% csrf_token %}
                    <br><label>・希望の座席を選択してください</label>
                <div class="seats button-container">
                    <button type="button" class="seat-button" data-value="カウンター">カウンター席 ({{ counter_seats }}席)</button>
                    <button type="button" class="seat-button" data-value="テーブル">テーブル席 ({{ table_seats }}席)</button>
                    <button type="button" class="seat-button" data-value="ソファー">ソファー席 ({{ sofa_seats }}席)</button>
                    <input type="hidden" name="seat_type" id="seat_type">
                </div>
                <br><label>・コンセントは必要ですか</label>
                <div class="outlet button-container">
                    <button type="button" class="outlet-button" data-value="True">必須</button>
                    <button type="button" class="outlet-button" data-value="False">無くてもよい</button>
                    <input type="hidden" name="outlet" id="outlet">
                </div>
                
                <div id="error-message" style="color: red; display: none;">すべての項目を選択してください。</div>
                <div id="wait-time" style="color: blue; display: none;">待ち時間: <span id="wait-time-value"></span> 分</div>
            </form>
    </div>

    <script>
        document.querySelectorAll('.seat-button').forEach(function(button) {
            button.addEventListener('click', function() {
                document.querySelectorAll('.seat-button').forEach(function(btn) {
                    btn.classList.remove('button-selected');
                });
                button.classList.add('button-selected');
                document.getElementById('seat_type').value = button.getAttribute('data-value');
                updateWaitTime();
            });
        });

        document.querySelectorAll('.outlet-button').forEach(function(button) {
            button.addEventListener('click', function() {
                document.querySelectorAll('.outlet-button').forEach(function(btn) {
                    btn.classList.remove('button-selected');
                });
                button.classList.add('button-selected');
                document.getElementById('outlet').value = button.getAttribute('data-value');
                updateWaitTime();
            });
        });

        function updateWaitTime() {
            var seatType = document.getElementById('seat_type').value;
            var outlet = document.getElementById('outlet').value;

            if (seatType && outlet) {
                var seatTypeValue;
                if (seatType === "カウンター") {
                    seatTypeValue = 0;
                } else if (seatType === "テーブル") {
                    seatTypeValue = 1;
                } else if (seatType === "ソファー") {
                    seatTypeValue = 2;
                }

                $.ajax({
                    url: "{% url 'reception_system:calculate_wait_time' %}",
                    method: "POST",
                    data: {
                        'seat_type': seatTypeValue,
                        'outlet': outlet,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        document.getElementById('wait-time').style.display = 'block';
                        document.getElementById('wait-time-value').innerText = response.wait_time;
                    }
                });
            }
        }

        document.querySelectorAll('seat_type').forEach(function(element) {
            element.addEventListener('change', updateWaitTime);
        });
        document.querySelectorAll('outlet').forEach(function(element) {
            element.addEventListener('change', updateWaitTime);
        });
        document.getElementById('seatForm').addEventListener('submit', function(event) {
            var seatType = document.getElementById('seat_type').value;
            var outlet = document.getElementById('outlet').value;
            if (!seatTypeSelected || !outletSelected ) {
                event.preventDefault(); // フォームの送信を停止
                document.getElementById('error-message').style.display = 'block'; // エラーメッセージを表示
            }
        });
    </script>

    <div class="button-container">
        <a href="{% url 'reception_system:index' %}"><button class="circle-button">戻る</button></a>
        <a href="{% url 'reception_system:reserve_success' %}"><button class="circle-button">次へ</button></a>
    </div>

</body>
</html>